<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>    Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù…ÙˆØ¸ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ </title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand-orange: #faa619;
            --brand-green: #1a953e;
            --light-bg: #fdfcfb;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Cairo', sans-serif; 
        font-size: 12px; 
        color:black;  
        margin: 0;
        padding: 0;
        }
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border-top: 8px solid var(--brand-orange);
        }
        textarea {
            resize: vertical;
            min-height: 150px;
            border-color: #eee;
        }
        textarea:focus {
            border-color: var(--brand-orange) !important;
            box-shadow: 0 0 0 0.25rem rgba(250, 166, 25, 0.25) !important;
        }
        th {
            background-color: var(--brand-green) !important;
            color: white !important;
            text-align: center;
            border-bottom: 3px solid var(--brand-orange) !important;
            position: relative;
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯ */
        .copy-col-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            font-size: 0.7em;
            margin-right: 5px;
            padding: 2px 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .copy-col-btn:hover {
            background: var(--brand-orange);
        }
        td {
            vertical-align: middle;
            text-align: center;
        }
        .note-badge {
            background-color: var(--brand-orange);
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            display: inline-block;
            margin: 2px;
            font-weight: 500;
        }
        .interactive-cell {
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .interactive-cell:hover {
            background-color: #fff9f0 !important;
            color: var(--brand-orange);
        }
        .interactive-cell:focus {
            background-color: #fff3cd !important;
            outline: 2px solid var(--brand-orange);
        }
        /* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙ Ø§Ù„Ù…Ø´Ø·ÙˆØ¨ (ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„) --- */
        .completed-row {
            background-color: #f0f0f0 !important;
            color: #999 !important;
            text-decoration: line-through;
        }
        .completed-row .interactive-cell {
            color: #999 !important; /* ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ù„Ù„Ø±Ù…Ø§Ø¯ÙŠ */
        }
        .completed-row .amount-cell {
            color: #999 !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± Ù„Ù„Ù…Ø¨Ù„Øº */
            text-decoration: line-through;
        }
        
        #toast {
            visibility: hidden;
            min-width: 200px;
            background-color: var(--brand-green);
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 12px;
            position: fixed;
            z-index: 1000;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
        }
        .stats-card {
            background-color: #f0f9f1;
            border-left: 5px solid var(--brand-green);
            padding: 15px;
            border-radius: 8px;
        }
        .sender-info-box {
            background-color: #fffdf9;
            border: 1px solid #ffeeba;
            border-right: 5px solid var(--brand-orange);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .text-primary { color: var(--brand-orange) !important; }
        .btn-primary { 
            background-color: var(--brand-green) !important; 
            border-color: var(--brand-green) !important; 
        }
        .btn-success { 
            background-color: var(--brand-orange) !important; 
            border-color: var(--brand-orange) !important; 
            color: white !important;
        }
    </style>
</head>
<body onload="loadSavedData()">

<div class="container">
 <h2 class="fw-bold mb-1"><i class="bi bi-shield-fill-check me-2"></i> Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡  </h2>
        <p class="mb-0 opacity-90">Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ±Ø² Ø§Ù„Ø¢Ù„ÙŠ ÙˆØªÙ†Ø³ÙŠÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡  </p>
          
<div class="sender-info-box">
    <h5 class="mb-3 fw-bold" style="color: var(--brand-orange)">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ </h5>
    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label fw-bold">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„:</label>
            <input type="text" id="mainSenderName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„" list="namesList" oninput="autoFillSenderInfo()">
            <datalist id="namesList"></datalist>
        </div>
        <div class="col-md-4">
            <label class="form-label fw-bold">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø±Ø³Ù„:</label>
<input type="text" id="mainSenderAccount" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨" 
       oninput="this.value = normalizeNumbers(this.value)">            </div>
        <div class="col-md-4">
            <label class="form-label fw-bold">Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±Ø³Ù„:</label>
<input type="text" id="mainSenderPhone" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" 
       oninput="this.value = normalizeNumbers(this.value)">        </div>
    </div>
</div>
    <div class="mb-3">
        <label for="inputText" class="form-label fw-bold">Ù‚Ù… Ø¨Ù„ØµÙ‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù‡Ù†Ø§:</label>
        <textarea class="form-control shadow-sm" id="inputText" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
    </div>

    <div class="d-flex gap-2 justify-content-center mb-4 flex-wrap">
                <button class="btn btn-success px-4 shadow-sm" onclick="formatText()">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ ÙƒÙ‚Ø§Ø¦Ù…Ø©</button>

        <button class="btn btn-primary px-4 shadow-sm" onclick="analyzeAndBuildTable()">ØªØ­Ù„ÙŠÙ„ ÙˆØ¹Ø±Ø¶ ÙÙŠ Ø¬Ø¯ÙˆÙ„</button>
        <button class="btn btn-outline-dark px-3 d-none tool-btn" onclick="exportTableToCSV()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥ÙƒØ³Ù„</button>
        <button class="btn btn-outline-secondary px-3 d-none tool-btn" onclick="clearHistory()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>

    <div id="dashboard" class="d-none mb-3">
        <div class="row align-items-center">
            
            <div class="col-md-6 mb-2">
                <input type="text" id="searchInput" class="form-control form-control-lg border-success" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§..." onkeyup="filterTable()">
            </div>
             <div class="col-md-6 mb-2">
                <div class="stats-card d-flex justify-content-between align-items-center shadow-sm">
                    <h5 class="mb-0 fw-bold" style="color: var(--brand-green)">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©): <span id="totalAmount">0</span></h5>
                    <h6 class="mb-0 text-secondary">Ø¹Ø¯Ø¯ Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª: <span id="totalCount">0</span></h6>
                </div>
            </div>
        </div>
        <p class="text-muted small mt-2 text-center">ğŸ’¡ ØªÙ„Ù…ÙŠØ­: <strong>Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¨Ø¹</strong> Ù„Ø´Ø·Ø¨ Ø§Ù„Ø­ÙˆØ§Ù„Ø© ÙˆØ®ØµÙ…Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ | <strong>Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</strong> Ù„Ù„Ù†Ø³Ø®</p>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-hover d-none" id="resultTable">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ø±Ø³Ù„ <button class="copy-col-btn" onclick="copyColumn(0)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ <button class="copy-col-btn" onclick="copyColumn(1)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>
                    <th>Ù‡Ø§ØªÙ Ù…. <button class="copy-col-btn" onclick="copyColumn(2)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº <button class="copy-col-btn" onclick="copyColumn(3)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>

                    <th>Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„ <button class="copy-col-btn" onclick="copyColumn(4)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>
                    <th>ØªÙ„ÙÙˆÙ† Ø§Ù„Ù…Ø³ØªÙ„Ù… <button class="copy-col-btn" onclick="copyColumn(5)" title="Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯">ğŸ“‹</button></th>
                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th> 
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<div id="toast">âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!</div>

<script>
    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ ---
    
    // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù‡Ø§ØªÙ (ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„)
    function saveToSenderDatabase() {
        const name = document.getElementById('mainSenderName').value.trim();
        const account = document.getElementById('mainSenderAccount').value.trim();
        const phone = document.getElementById('mainSenderPhone').value.trim();

        if (!name || name === "-" || name === "") return;

        let db = JSON.parse(localStorage.getItem('senderDatabase') || '{}');

        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ø§Ù„Ø§Ø³Ù…
        db[name] = {
            account: account.replace(' /', ''),
            phone: phone
        };

        localStorage.setItem('senderDatabase', JSON.stringify(db));
        updateDatalists();
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    function autoFillSenderInfo() {
        const nameInput = document.getElementById('mainSenderName').value;
        const db = JSON.parse(localStorage.getItem('senderDatabase') || '{}');
        
        if (db[nameInput]) {
            document.getElementById('mainSenderAccount').value = db[nameInput].account;
            document.getElementById('mainSenderPhone').value = db[nameInput].phone;
        }
    }

    function loadSavedData() {
        updateDatalists();
    }

    function updateDatalists() {
        const db = JSON.parse(localStorage.getItem('senderDatabase') || '{}');
        const namesList = document.getElementById('namesList');
        if (namesList) {
            namesList.innerHTML = Object.keys(db).map(n => `<option value="${n}">`).join('');
        }
    }

    function clearHistory() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ")) {
            localStorage.removeItem('senderDatabase');
            updateDatalists();
            document.getElementById('mainSenderName').value = "";
            document.getElementById('mainSenderAccount').value = "";
            document.getElementById('mainSenderPhone').value = "";
            alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­");
        }
    }

    // --- ÙˆØ¸ÙŠÙØ© Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯ ---
    function copyColumn(index) {
        const rows = document.querySelectorAll("#tableBody tr");
        let colData = [];
        rows.forEach(row => {
            if (row.style.display !== 'none') {
                let cellText = row.cells[index].innerText.replace(' /', '').trim();
                colData.push(cellText);
            }
        });
        if (colData.length > 0) {
            navigator.clipboard.writeText(colData.join('\n')).then(() => {
                const toast = document.getElementById("toast");
                toast.innerText = "âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!";
                showToast();
            });
        }
    }

    // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ---
    function normalizeNumbers(text) {
        return text.replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d));
    }

    function splitIntoRecords(rawText) {
        let text = normalizeNumbers(rawText);
        let lines = text.split('\n');
        let records = [];
        let currentRecord = "";
        for (let i = 0; i < lines.length; i++) {
            let line = lines[i].trim();
            if (line === "") {
                if (currentRecord !== "") { records.push(currentRecord); currentRecord = ""; }
                continue;
            }
            let hasPhone = /7\d{8}/.test(currentRecord);
            let lineHasPhone = /7\d{8}/.test(line);
            if (hasPhone && lineHasPhone) {
                records.push(currentRecord);
                currentRecord = line;
            } else {
                currentRecord += (currentRecord ? " " : "") + line;
            }
        }
        if (currentRecord !== "") records.push(currentRecord);
        return records;
    }

    function parseRecord(recordText) {
        let text = recordText.replace(/[\.\-\(\)]/g, ' ').replace(/\s+/g, ' ').trim();
        let phone = "", amount = "0", name = "", notes = [];
        let phoneMatch = text.match(/\b(7\d{8})\b/);
        if (phoneMatch) { phone = phoneMatch[1]; text = text.replace(phoneMatch[1], ' '); }

        let transferRegex = /(?:\d+(?:[,ØŒ]\d+)?\s*(?:Ø§Ù„Ù|Ø£Ù„Ù)?\s*)?(?:Ø§Ù„Ù‰|Ø¥Ù„Ù‰)\s*([^\s\d]+)/g;
        let tMatch;
        while ((tMatch = transferRegex.exec(text)) !== null) {
            notes.push(tMatch[0]);
            text = text.replace(tMatch[0], ' ');
        }

        let amountMatch = text.match(/(?:Ø­ÙˆÙ„Ù‡\s*)?(\d+(?:[,ØŒ]\d+)?)(?:\s*(Ø§Ù„Ù|Ø£Ù„Ù))?/);
        if (amountMatch) {
            let numStr = amountMatch[1].replace(/[,ØŒ]/g, ''); 
            let num = parseFloat(numStr);
            let hasAlf = amountMatch[2] !== undefined || text.includes('Ø§Ù„Ù') || text.includes('Ø£Ù„Ù');
            if (hasAlf && num < 1000) num = num * 1000;
            amount = num.toString();
            text = text.replace(amountMatch[0], ' ');
        }

        let ignoreWords = ['Ø§Ù„Ù', 'Ø£Ù„Ù', 'ÙŠÙ…Ù†ÙŠ', 'Ø­ÙˆÙ„Ù‡', 'Ø­ÙˆÙ„'];
        let words = text.split(/\s+/).filter(w => w);
        let nameWords = [];
        words.forEach(w => {
            if (/^[\u0600-\u06FF]+$/.test(w) && !ignoreWords.includes(w)) {
                nameWords.push(w);
            } else if (w && !ignoreWords.includes(w)) {
                notes.push(w);
            }
        });
        return { amount: amount || "0", name: nameWords.join(' ') || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", phone: phone || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", notes: notes };
    }

    function formatText() {
        const textarea = document.getElementById('inputText');
        const rawText = textarea.value;
        if (!rawText.trim()) return;
        const records = splitIntoRecords(rawText);
        let formattedText = "";
        records.forEach(record => {
            const data = parseRecord(record);
            let noteStr = data.notes.length > 0 ? ` (Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${data.notes.join(' - ')})` : "";
            formattedText += `${data.amount} - ${data.name} - ${data.phone}${noteStr}\n`;
        });
        textarea.value = formattedText;
    }

    function analyzeAndBuildTable() {
        const rawText = document.getElementById('inputText').value;
        if (!rawText.trim()) return;

        const mainSender = document.getElementById('mainSenderName').value || "-";
        const mainAcc = document.getElementById('mainSenderAccount').value;
        const mainPhone = document.getElementById('mainSenderPhone').value || "-";
        const formattedAcc = mainAcc ? mainAcc + " /" : "-";

        saveToSenderDatabase();

        const records = splitIntoRecords(rawText);
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = ""; 

        records.forEach(record => {
            const data = parseRecord(record);
            let notesHtml = data.notes.length > 0 
                ? data.notes.map(n => `<span class="note-badge">${n}</span>`).join('') 
                : '<span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>';

            const row = `<tr>
                <td class="interactive-cell">${mainSender}</td>
                <td class="interactive-cell">${formattedAcc}</td>
                <td class="interactive-cell text-secondary">${mainPhone}</td>
                <td class="interactive-cell fw-bold text-success amount-cell">${data.amount}</td>
                <td class="interactive-cell fw-bold name-cell">${data.name}</td>
                <td class="interactive-cell text-primary fw-bold phone-cell" dir="ltr">${data.phone}</td>
                <td>${notesHtml}</td>
                <td class="text-center">
                    <input type="checkbox" class="form-check-input" style="cursor:pointer; transform: scale(1.3);" onchange="toggleRowStatus(this)" title="Ø­Ø¯Ø¯ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„">
                </td>
                <td><button class="btn btn-sm btn-outline-danger border-0" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        });

        document.getElementById('resultTable').classList.remove('d-none');
        document.getElementById('dashboard').classList.remove('d-none');
        document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('d-none'));
        updateTotals();
    }

    // --- ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ ---
    function toggleRowStatus(checkbox) {
        const row = checkbox.closest('tr');
        if (checkbox.checked) {
            row.classList.add('completed-row');
        } else {
            row.classList.remove('completed-row');
        }
        updateTotals(); // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const tableBody = document.getElementById('tableBody');
    tableBody.addEventListener('click', function(e) {
        if (e.target.classList.contains('interactive-cell')) {
            if (e.target.getAttribute('contenteditable') === 'true') return;
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ Ù…Ø´Ø·ÙˆØ¨Ø§Ù‹ØŒ Ù„Ø§ ØªÙ‚Ù… Ø¨Ø§Ù„Ù†Ø³Ø®
            if (e.target.closest('tr').classList.contains('completed-row')) return;
            
            let textToCopy = e.target.innerText.replace(' /', '').trim();
            navigator.clipboard.writeText(textToCopy).then(() => {
                document.getElementById("toast").innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!";
                showToast();
            });
        }
    });

    tableBody.addEventListener('dblclick', function(e) {
        if (e.target.classList.contains('interactive-cell')) {
            // Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­ÙˆØ§Ù„Ø© Ù…ÙƒØªÙ…Ù„Ø©
            if (e.target.closest('tr').classList.contains('completed-row')) return;
            
            e.target.setAttribute('contenteditable', 'true');
            e.target.focus();
            document.execCommand('selectAll', false, null);
        }
    });

    tableBody.addEventListener('focusout', saveEdit);
    tableBody.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') { e.preventDefault(); e.target.blur(); }
    });

    function saveEdit(e) {
        if (e.target.classList.contains('interactive-cell') && e.target.getAttribute('contenteditable') === 'true') {
            e.target.setAttribute('contenteditable', 'false');
            updateTotals();
        }
    }

    function showToast() {
        const toast = document.getElementById("toast");
        toast.className = "show";
        setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2000);
    }

    function deleteRow(btn) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
            btn.closest('tr').remove();
            updateTotals();
        }
    }

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙŠØ­Ø³Ø¨ ÙÙ‚Ø· Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„Ù…Ø´Ø·ÙˆØ¨Ø© ---
    function updateTotals() {
        let total = 0, count = 0;
        const amountCells = document.querySelectorAll('.amount-cell');
        amountCells.forEach(cell => {
            const row = cell.closest('tr');
            // Ø§Ù„Ø´Ø±Ø·: Ø§Ù„ØµÙ Ø¸Ø§Ù‡Ø± + Ø§Ù„ØµÙ Ù„ÙŠØ³ Ù…ÙƒØªÙ…Ù„ (Ù„ÙŠØ³ Ù…Ø´Ø·ÙˆØ¨Ø§Ù‹)
            if (row.style.display !== 'none' && !row.classList.contains('completed-row')) {
                let val = parseFloat(cell.innerText.replace(/,/g, ''));
                if (!isNaN(val)) total += val;
                count++;
            }
        });
        document.getElementById('totalAmount').innerText = total.toLocaleString();
        document.getElementById('totalCount').innerText = count;
    }

    function filterTable() {
        const input = document.getElementById("searchInput").value.toLowerCase();
        const rows = document.getElementById("tableBody").getElementsByTagName("tr");
        for (let i = 0; i < rows.length; i++) {
            let rowText = rows[i].innerText.toLowerCase();
            rows[i].style.display = rowText.includes(input) ? "" : "none";
        }
        updateTotals();
    }

    // --- ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ù„ØªØ´Ù…Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙˆØ§Ù„Ø© ---
    function exportTableToCSV() {
        let csv = '\uFEFF'; // BOM for Excel Arabic support
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„
        csv += "Ø§Ù„Ù…Ø±Ø³Ù„,Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨,Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±Ø³Ù„,Ø§Ù„Ù…Ø¨Ù„Øº,Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„,ØªÙ„ÙÙˆÙ† Ø§Ù„Ù…Ø³ØªÙ„Ù…,Ù…Ù„Ø§Ø­Ø¸Ø§Øª,Ø§Ù„Ø­Ø§Ù„Ø©\n";

        const rows = document.querySelectorAll("#resultTable tbody tr");
        for (let i = 0; i < rows.length; i++) {
            if (rows[i].style.display === 'none') continue;
            
            let rowData = [];
            let cols = rows[i].querySelectorAll("td");
            
            // Ù†Ø£Ø®Ø° Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 6 (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)
            for (let j = 0; j <= 6; j++) {
                if (cols[j]) {
                    let text = cols[j].innerText.replace('ğŸ“‹', '').replace(' /', '').trim();
                    rowData.push('"' + text.replace(/"/g, '""') + '"');
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø±Ù‚Ù… 7 Ù‡Ùˆ Checkbox)
            const checkbox = cols[7].querySelector('input[type="checkbox"]');
            const status = checkbox && checkbox.checked ? "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„" : "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
            rowData.push('"' + status + '"');

            csv += rowData.join(",") + "\n";
        }
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.setAttribute("href", URL.createObjectURL(blob));
        link.setAttribute("download", "ÙƒØ´Ù_Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª_Ù…Ø¹_Ø§Ù„Ø­Ø§Ù„Ø©.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
</body>
</html>
